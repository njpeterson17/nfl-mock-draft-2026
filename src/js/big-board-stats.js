// Big Board Stats Framework v2
// Automatically injects stats containers and displays 2025 college football statistics
// Integrates with player-stats-2025.js data

/**
 * Create HTML structure for stats display
 * @returns {string} HTML string for stats container
 */
function createStatsHTML() {
          return `
                  <div class="bb-stats-container">
                              <div class="bb-season-year">2025 Season Stats</div>

                                                      <!-- Defensive Stats (CB, S, LB, DL, EDGE) -->
                                                                  <div class="bb-stats-row" data-position="CB,S,LB,DL,EDGE" style="display: none;">
                                                                                  <div class="bb-stat-item">
                                                                                                      <div class="bb-stat-label">Tackles</div>
                                                                                                                          <div class="bb-stat-value" data-stat="tackles">0</div>
                                                                                                                                          </div>
                                                                                                                                                          <div class="bb-stat-item">
                                                                                                                                                                              <div class="bb-stat-label">Sacks</div>
                                                                                                                                                                                                  <div class="bb-stat-value" data-stat="sacks">0.0</div>
                                                                                                                                                                                                                  </div>
                                                                                                                                                                                                                                  <div class="bb-stat-item">
                                                                                                                                                                                                                                                      <div class="bb-stat-label">TFL</div>
                                                                                                                                                                                                                                                                          <div class="bb-stat-value" data-stat="tfl">0</div>
                                                                                                                                                                                                                                                                                          </div>
                                                                                                                                                                                                                                                                                                          <div class="bb-stat-item">
                                                                                                                                                                                                                                                                                                                              <div class="bb-stat-label">PD</div>
                                                                                                                                                                                                                                                                                                                                                  <div class="bb-stat-value" data-stat="pd">0</div>
                                                                                                                                                                                                                                                                                                                                                                  </div>
                                                                                                                                                                                                                                                                                                                                                                                  <div class="bb-stat-item">
                                                                                                                                                                                                                                                                                                                                                                                                      <div class="bb-stat-label">INT</div>
                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="bb-stat-value" data-stat="int">0</div>
                                                                                                                                                                                                                                                                                                                                                                                                                                          </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                      </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <!-- Offensive Stats (RB, WR, TE) -->
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="bb-stats-row" data-position="RB,WR,TE" style="display: none;">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="bb-stat-item">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <div class="bb-stat-label">Rec</div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="bb-stat-value" data-stat="rec">0</div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="bb-stat-item">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <div class="bb-stat-label">Yds</div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="bb-stat-value" data-stat="yds">0</div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="bb-stat-item">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <div class="bb-stat-label">TDs</div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="bb-stat-value" data-stat="tds">0</div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="bb-stat-item">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <div class="bb-stat-label">Avg</div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="bb-stat-value" data-stat="avg">0.0</div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <!-- QB-Specific Stats -->
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="bb-stats-row" data-position="QB" style="display: none;">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="bb-stat-item">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <div class="bb-stat-label">Pass Yds</div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="bb-stat-value" data-stat="passYds">0</div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="bb-stat-item">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <div class="bb-stat-label">Pass TDs</div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="bb-stat-value" data-stat="passTds">0</div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="bb-stat-item">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <div class="bb-stat-label">INTs</div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="bb-stat-value" data-stat="ints">0</div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="bb-stat-item">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <div class="bb-stat-label">Comp%</div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="bb-stat-value" data-stat="compPct">0%</div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  `;
}

/**
 * Initialize Big Board stats display
 * Injects stats containers and populates them with data
 */
function initBigBoardStats() {
          const bbItems = document.querySelectorAll('.big-board-item');

    bbItems.forEach(item => {
                  // Skip if stats already exist
                            if (item.querySelector('.bb-stats-container')) {
                                              return;
                            }

                            const position = item.getAttribute('data-position');
                  const playerInfo = item.querySelector('.bb-player-info h2');

                            if (!playerInfo || !position) return;

                            // Extract player name (before the dash)
                            const playerName = playerInfo.textContent.trim().split(' - ')[0];

                            // Inject HTML container
                            const lastDiv = item.querySelector('.bb-grade:last-of-type') || item.querySelector('[class*="bb-"]:last-of-type');
                  if (lastDiv) {
                                    lastDiv.insertAdjacentHTML('afterend', createStatsHTML());
                  } else {
                                    item.innerHTML += createStatsHTML();
                  }

                            // Populate stats if function exists (from player-stats-2025.js)
                            const statsContainer = item.querySelector('.bb-stats-container');
                  if (statsContainer && typeof getDisplayStats !== 'undefined') {
                                    const displayStats = getDisplayStats(playerName, position);
                                    updateStatValues(statsContainer, displayStats);
                                    updateStatRowVisibility(statsContainer, position);
                  }
    });
}

/**
 * Update stat values in DOM
 * @param {Element} container - Stats container element
 * @param {Object} statsData - Stats object with values
 */
function updateStatValues(container, statsData) {
          Object.keys(statsData).forEach(statKey => {
                        const statElements = container.querySelectorAll(`[data-stat="${statKey}"]`);
                        statElements.forEach(element => {
                                          element.textContent = statsData[statKey];
                        });
          });
}

/**
 * Show/hide stat rows based on position
 * @param {Element} container - Stats container element
 * @param {string} position - Player position
 */
function updateStatRowVisibility(container, position) {
          const rows = container.querySelectorAll('.bb-stats-row');

    rows.forEach(row => {
                  const posAttribute = row.getAttribute('data-position');
                  if (!posAttribute) return;

                         const positions = posAttribute.split(',').map(p => p.trim());
                  row.style.display = positions.includes(position) ? 'grid' : 'none';
    });
}

/**
 * Refresh stats for all Big Board items
 */
function refreshBigBoardStats() {
          initBigBoardStats();
}

// Wait for both player data and DOM to be ready
function waitForDependencies() {
          if (typeof getDisplayStats !== 'undefined' && document.readyState === 'loading') {
                        document.addEventListener('DOMContentLoaded', initBigBoardStats);
          } else if (typeof getDisplayStats !== 'undefined') {
                        // Player data is ready
              initBigBoardStats();
          } else {
                        // Player data not ready yet, wait a bit
              setTimeout(waitForDependencies, 100);
          }
}

// Initialize when page loads
if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', waitForDependencies);
} else {
          waitForDependencies();
}

// Re-initialize if Big Board is dynamically updated
window.addEventListener('bigBoardLoaded', initBigBoardStats);
window.addEventListener('bigBoardUpdated', refreshBigBoardStats);
