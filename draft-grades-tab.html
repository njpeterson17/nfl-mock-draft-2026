<!-- ============================================
     DRAFT GRADES TAB CONTENT
     2026 NFL Mock Draft
     ============================================ -->

<!-- Draft Grades Tab -->
<div id="draftGrades" class="tab-content">
    <div class="draft-grades-container">
        <!-- Header -->
        <div class="draft-grades-header">
            <h2><i class="fas fa-star"></i> Draft Grades</h2>
            <p>AI-powered grading system analyzing value, need, fit, and round appropriateness</p>
        </div>
        
        <!-- Controls -->
        <div class="grades-controls">
            <label class="grades-toggle">
                <input type="checkbox" id="showGradesToggle" checked onchange="toggleGradesDisplay()">
                <span>Show Grades on Picks</span>
            </label>
            <button class="export-grade-btn" onclick="exportGradesReport()">
                <i class="fas fa-download"></i> Export Report
            </button>
        </div>
        
        <!-- Overall Leaderboard -->
        <div class="grades-section">
            <h3 class="grades-section-title">
                <i class="fas fa-trophy"></i> Team Draft Rankings
            </h3>
            <div id="teamGradesLeaderboard" class="team-grades-list">
                <!-- Populated by JavaScript -->
                <div class="loading-placeholder">
                    <i class="fas fa-circle-notch fa-spin"></i>
                    <span>Calculating grades...</span>
                </div>
            </div>
        </div>
        
        <!-- Detailed Team Analysis -->
        <div class="grades-section">
            <h3 class="grades-section-title">
                <i class="fas fa-chart-bar"></i> Detailed Analysis
            </h3>
            <div id="detailedTeamAnalysis" class="detailed-analysis-list">
                <!-- Populated by JavaScript -->
            </div>
        </div>
        
        <!-- Grade Methodology -->
        <div class="grades-methodology">
            <h4><i class="fas fa-info-circle"></i> Grading Methodology</h4>
            <div class="methodology-grid">
                <div class="methodology-item">
                    <div class="methodology-icon value"><i class="fas fa-dollar-sign"></i></div>
                    <div class="methodology-content">
                        <h5>Value (40%)</h5>
                        <p>Compares pick number to player's Big Board rank. Better value = higher grade.</p>
                    </div>
                </div>
                <div class="methodology-item">
                    <div class="methodology-icon need"><i class="fas fa-bullseye"></i></div>
                    <div class="methodology-content">
                        <h5>Need (30%)</h5>
                        <p>Evaluates if team has high, medium, or low need at the player's position.</p>
                    </div>
                </div>
                <div class="methodology-item">
                    <div class="methodology-icon fit"><i class="fas fa-puzzle-piece"></i></div>
                    <div class="methodology-content">
                        <h5>Fit (20%)</h5>
                        <p>Considers positional value. Premium positions (QB, EDGE, OT, CB) get bonus.</p>
                    </div>
                </div>
                <div class="methodology-item">
                    <div class="methodology-icon round"><i class="fas fa-layer-group"></i></div>
                    <div class="methodology-content">
                        <h5>Round (10%)</h5>
                        <p>Assesses if player is typically drafted in this round based on tier.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Grade Breakdown Modal -->
<div id="gradeModal" class="grade-modal-overlay">
    <div class="grade-modal">
        <button class="grade-modal-close" onclick="closeGradeModal()">
            <i class="fas fa-times"></i>
        </button>
        <div id="gradeModalContent">
            <!-- Populated by JavaScript -->
        </div>
    </div>
</div>

<!-- Additional Styles for Tab Content -->
<style>
/* Grades Controls */
.grades-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    padding: 1rem;
    background: var(--card-bg);
    border-radius: 12px;
    border: 1px solid var(--border);
}

.export-grade-btn {
    background: var(--accent);
    color: var(--primary);
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.3s ease;
}

.export-grade-btn:hover {
    background: var(--accent-hover);
    transform: translateY(-2px);
}

/* Grades Section */
.grades-section {
    margin-bottom: 2.5rem;
}

.grades-section-title {
    font-family: 'Oswald', sans-serif;
    font-size: 1.3rem;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--text-primary);
}

.grades-section-title i {
    color: var(--accent);
}

/* Loading Placeholder */
.loading-placeholder {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
    padding: 3rem;
    color: var(--text-secondary);
}

.loading-placeholder i {
    font-size: 2rem;
    color: var(--accent);
}

/* Methodology Section */
.grades-methodology {
    background: var(--card-bg);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 1.5rem;
    margin-top: 2rem;
}

.grades-methodology h4 {
    font-family: 'Oswald', sans-serif;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--accent);
}

.methodology-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 1rem;
}

.methodology-item {
    display: flex;
    gap: 1rem;
    padding: 1rem;
    background: var(--primary);
    border-radius: 10px;
    border: 1px solid var(--border);
}

.methodology-icon {
    width: 45px;
    height: 45px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    flex-shrink: 0;
}

.methodology-icon.value {
    background: rgba(0, 255, 136, 0.15);
    color: #00ff88;
}

.methodology-icon.need {
    background: rgba(0, 212, 255, 0.15);
    color: #00d4ff;
}

.methodology-icon.fit {
    background: rgba(255, 184, 0, 0.15);
    color: #ffb800;
}

.methodology-icon.round {
    background: rgba(255, 107, 53, 0.15);
    color: #ff6b35;
}

.methodology-content h5 {
    margin-bottom: 0.25rem;
    font-size: 0.95rem;
}

.methodology-content p {
    font-size: 0.8rem;
    color: var(--text-secondary);
    line-height: 1.4;
}

/* Detailed Team Card */
.detailed-team-card {
    background: var(--card-bg);
    border: 1px solid var(--border);
    border-radius: 16px;
    margin-bottom: 1.5rem;
    overflow: hidden;
}

.detailed-team-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1.25rem 1.5rem;
    background: linear-gradient(90deg, rgba(0, 212, 255, 0.05) 0%, transparent 100%);
    border-bottom: 1px solid var(--border);
    cursor: pointer;
    transition: all 0.3s ease;
}

.detailed-team-header:hover {
    background: linear-gradient(90deg, rgba(0, 212, 255, 0.1) 0%, transparent 100%);
}

.detailed-team-info {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.detailed-team-info h4 {
    font-family: 'Oswald', sans-serif;
    font-size: 1.2rem;
}

.detailed-team-meta {
    font-size: 0.8rem;
    color: var(--text-secondary);
}

.detailed-team-content {
    padding: 1.5rem;
    display: none;
}

.detailed-team-content.expanded {
    display: block;
    animation: slideDown 0.3s ease;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Pick List in Detailed View */
.team-picks-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.team-pick-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 0.75rem;
    background: var(--primary);
    border-radius: 8px;
    border: 1px solid var(--border);
    cursor: pointer;
    transition: all 0.3s ease;
}

.team-pick-item:hover {
    border-color: var(--accent);
    transform: translateX(5px);
}

.team-pick-number {
    font-family: 'Oswald', sans-serif;
    font-weight: 700;
    color: var(--accent);
    min-width: 35px;
}

.team-pick-info {
    flex: 1;
}

.team-pick-name {
    font-weight: 600;
}

.team-pick-position {
    font-size: 0.8rem;
    color: var(--text-secondary);
}

.team-pick-grade {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
}

.team-pick-breakdown {
    display: flex;
    gap: 0.5rem;
    margin-top: 0.25rem;
}

.breakdown-mini {
    font-size: 0.65rem;
    padding: 0.15rem 0.35rem;
    border-radius: 4px;
    background: var(--card-bg);
}

/* Expand/Collapse Icon */
.expand-icon {
    transition: transform 0.3s ease;
    color: var(--text-secondary);
}

.detailed-team-header.expanded .expand-icon {
    transform: rotate(180deg);
}

/* Responsive */
@media (max-width: 768px) {
    .grades-controls {
        flex-direction: column;
        gap: 1rem;
    }
    
    .methodology-grid {
        grid-template-columns: 1fr;
    }
    
    .detailed-team-header {
        flex-wrap: wrap;
        gap: 1rem;
    }
    
    .team-pick-breakdown {
        display: none;
    }
}
</style>

<!-- Tab JavaScript -->
<script>
// Initialize Draft Grades Tab
function initDraftGradesTab() {
    renderTeamGradesLeaderboard();
    renderDetailedTeamAnalysis();
}

// Render Team Grades Leaderboard
function renderTeamGradesLeaderboard() {
    const container = document.getElementById('teamGradesLeaderboard');
    if (!container) return;
    
    // Get all picks from DOM
    const picks = extractAllPicksFromDOM();
    
    // Calculate grades for each team
    const teamGrades = [];
    const teams = {};
    
    picks.forEach(pick => {
        if (!teams[pick.team]) {
            teams[pick.team] = [];
        }
        teams[pick.team].push(pick);
    });
    
    Object.entries(teams).forEach(([teamName, teamPicks]) => {
        const grade = window.DraftGradesSystem.calculateOverallDraftGrade(teamPicks);
        teamGrades.push({
            teamName,
            ...grade
        });
    });
    
    // Sort by score descending
    teamGrades.sort((a, b) => b.score - a.score);
    
    // Render
    container.innerHTML = teamGrades.map((team, index) => `
        <div class="team-grade-card" style="animation-delay: ${index * 0.05}s">
            <div class="team-grade-rank">#${index + 1}</div>
            <div class="team-grade-info">
                <div class="team-grade-name">
                    ${getTeamHelmetSVG(team.teamName)}
                    ${team.teamName}
                </div>
                <div class="team-grade-picks">${team.picks.length} picks analyzed</div>
                <div class="team-grade-breakdown">
                    <div class="grade-metric">
                        <span class="grade-metric-value">${Math.round(team.picks.reduce((sum, p) => sum + p.breakdown.value.score, 0) / team.picks.length)}</span>
                        <span class="grade-metric-label">Value</span>
                    </div>
                    <div class="grade-metric">
                        <span class="grade-metric-value">${Math.round(team.picks.reduce((sum, p) => sum + p.breakdown.need.score, 0) / team.picks.length)}</span>
                        <span class="grade-metric-label">Need</span>
                    </div>
                    <div class="grade-metric">
                        <span class="grade-metric-value">${Math.round(team.picks.reduce((sum, p) => sum + p.breakdown.fit.score, 0) / team.picks.length)}</span>
                        <span class="grade-metric-label">Fit</span>
                    </div>
                </div>
            </div>
            <div class="team-grade-score-container">
                <div class="grade-badge ${team.bgClass}">
                    <span class="grade-letter">${team.letter}</span>
                </div>
                <span class="team-grade-score">${team.score}</span>
            </div>
        </div>
    `).join('');
}

// Render Detailed Team Analysis
function renderDetailedTeamAnalysis() {
    const container = document.getElementById('detailedTeamAnalysis');
    if (!container) return;
    
    const picks = extractAllPicksFromDOM();
    const teams = {};
    
    picks.forEach(pick => {
        if (!teams[pick.team]) {
            teams[pick.team] = [];
        }
        teams[pick.team].push(pick);
    });
    
    // Calculate and sort
    const teamGrades = Object.entries(teams).map(([teamName, teamPicks]) => ({
        teamName,
        ...window.DraftGradesSystem.calculateOverallDraftGrade(teamPicks)
    })).sort((a, b) => b.score - a.score);
    
    container.innerHTML = teamGrades.map((team, index) => `
        <div class="detailed-team-card">
            <div class="detailed-team-header" onclick="toggleTeamDetails(this)">
                <div class="detailed-team-info">
                    ${getTeamHelmetSVG(team.teamName)}
                    <div>
                        <h4>${team.teamName}</h4>
                        <div class="detailed-team-meta">Rank #${index + 1} • ${team.picks.length} picks</div>
                    </div>
                </div>
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <div class="grade-badge ${team.bgClass}">
                        <span class="grade-letter">${team.letter}</span>
                    </div>
                    <i class="fas fa-chevron-down expand-icon"></i>
                </div>
            </div>
            <div class="detailed-team-content">
                ${renderOverallGradeSection(team)}
                ${renderPicksHighlightSection(team)}
                ${renderPositionBreakdownSection(team)}
                ${renderHistoricalComparisonSection(team)}
                ${renderTeamPicksList(team)}
            </div>
        </div>
    `).join('');
}

// Render Overall Grade Section
function renderOverallGradeSection(team) {
    return `
        <div class="team-overall-section" style="margin-bottom: 1.5rem;">
            ${window.DraftGradesSystem.renderOverallGrade(team)}
        </div>
    `;
}

// Render Picks Highlight Section
function renderPicksHighlightSection(team) {
    if (!team.bestPick || !team.worstPick) return '';
    
    return `
        <div class="picks-highlight">
            <div class="picks-highlight-card best">
                <div class="picks-highlight-label"><i class="fas fa-thumbs-up"></i> Best Pick</div>
                <div class="picks-highlight-player">${team.bestPick.player}</div>
                <div class="picks-highlight-details">#${team.bestPick.pickNumber} • ${team.bestPick.position} • Grade: ${team.bestPick.letter}</div>
            </div>
            <div class="picks-highlight-card worst">
                <div class="picks-highlight-label"><i class="fas fa-thumbs-down"></i> Room for Improvement</div>
                <div class="picks-highlight-player">${team.worstPick.player}</div>
                <div class="picks-highlight-details">#${team.worstPick.pickNumber} • ${team.worstPick.position} • Grade: ${team.worstPick.letter}</div>
            </div>
        </div>
    `;
}

// Render Position Breakdown Section
function renderPositionBreakdownSection(team) {
    const positions = team.positionBreakdown;
    const maxCount = Math.max(...Object.values(positions));
    
    return `
        <div class="position-breakdown">
            <h4>Position Breakdown</h4>
            <div class="position-bars">
                ${Object.entries(positions).map(([pos, count]) => `
                    <div class="position-bar-item">
                        <span class="position-bar-label">${pos}</span>
                        <div class="position-bar-track">
                            <div class="position-bar-fill ${pos.toLowerCase()}" style="width: ${(count / maxCount) * 100}%; opacity: ${0.4 + (count / maxCount) * 0.6};">
                                <span class="position-bar-count">${count}</span>
                            </div>
                        </div>
                    </div>
                `).join('')}
            </div>
        </div>
    `;
}

// Render Historical Comparison Section
function renderHistoricalComparisonSection(team) {
    const comparison = window.DraftGradesSystem.getHistoricalComparison(team.teamName, team.score);
    
    return `
        <div class="historical-comparison">
            <h3><i class="fas fa-history"></i> Historical Comparison</h3>
            <div class="comparison-current">
                <div>
                    <div class="comparison-label">This Draft</div>
                    <div class="comparison-value">${comparison.current.grade} (${comparison.current.score})</div>
                </div>
                <i class="fas fa-arrow-right" style="color: var(--text-secondary);"></i>
                <div class="comparison-similar">
                    <div class="comparison-label">Similar to ${team.teamName} ${comparison.similar.year}</div>
                    <div style="font-family: 'Oswald', sans-serif; font-size: 1.3rem;">${comparison.similar.grade} (${comparison.similar.score})</div>
                    <div style="font-size: 0.8rem; color: var(--text-secondary);">Highlight: ${comparison.similar.highlight}</div>
                </div>
            </div>
            <div class="comparison-history-list">
                ${comparison.history.map(h => `
                    <div class="comparison-history-item">
                        <div class="comparison-history-year">${h.year}</div>
                        <div class="comparison-history-grade" style="color: ${h.score >= 90 ? '#00ff88' : h.score >= 80 ? '#00d4ff' : h.score >= 70 ? '#ffb800' : '#ff4757'};">${h.grade}</div>
                        <div class="comparison-history-highlight">${h.highlight}</div>
                    </div>
                `).join('')}
            </div>
        </div>
    `;
}

// Render Team Picks List
function renderTeamPicksList(team) {
    return `
        <div style="margin-top: 1.5rem;">
            <h4 style="margin-bottom: 1rem;">All Picks</h4>
            <div class="team-picks-list">
                ${team.picks.map(pick => `
                    <div class="team-pick-item" onclick="openPickGradeModal('${team.teamName}', ${pick.pickNumber}, '${pick.player}', '${pick.position}')">
                        <span class="team-pick-number">#${pick.pickNumber}</span>
                        <div class="team-pick-info">
                            <div class="team-pick-name">${pick.player}</div>
                            <div class="team-pick-position">${pick.position}</div>
                        </div>
                        <div class="team-pick-grade">
                            <span class="grade-badge ${pick.bgClass}" style="min-width: 40px; padding: 0.25rem 0.5rem;">
                                <span class="grade-letter" style="font-size: 1rem;">${pick.letter}</span>
                            </span>
                            <div class="team-pick-breakdown">
                                <span class="breakdown-mini" style="color: #00ff88;">V:${pick.breakdown.value.grade}</span>
                                <span class="breakdown-mini" style="color: #00d4ff;">N:${pick.breakdown.need.grade}</span>
                            </div>
                        </div>
                    </div>
                `).join('')}
            </div>
        </div>
    `;
}

// Toggle Team Details
function toggleTeamDetails(header) {
    const content = header.nextElementSibling;
    header.classList.toggle('expanded');
    content.classList.toggle('expanded');
}

// Open Pick Grade Modal
function openPickGradeModal(team, pickNumber, player, position) {
    window.DraftGradesSystem.openGradeModal({ team, pickNumber, player, position });
}

// Extract All Picks from DOM
function extractAllPicksFromDOM() {
    const picks = [];
    
    document.querySelectorAll('.pick-card').forEach(card => {
        const pickNumber = parseInt(card.querySelector('.pick-number')?.textContent);
        const teamName = card.querySelector('.team-details h3')?.textContent?.trim();
        const playerName = card.dataset.player;
        const position = card.dataset.position;
        
        if (pickNumber && teamName && playerName) {
            picks.push({ pickNumber, team: teamName, player: playerName, position });
        }
    });
    
    return picks;
}

// Get Team Helmet SVG
function getTeamHelmetSVG(teamName) {
    const abbrev = getTeamAbbreviation(teamName);
    return `
        <svg class="team-helmet" viewBox="0 0 100 70" style="width: 40px; height: 28px;">
            <ellipse cx="50" cy="35" rx="45" ry="30" fill="rgba(0,212,255,0.2)" stroke="var(--accent)" stroke-width="2"/>
            <text x="50" y="42" text-anchor="middle" fill="var(--accent)" font-size="14" font-weight="bold" font-family="Arial">${abbrev}</text>
        </svg>
    `;
}

// Toggle Grades Display
function toggleGradesDisplay() {
    const show = document.getElementById('showGradesToggle')?.checked;
    document.querySelectorAll('.pick-grade-badge').forEach(badge => {
        badge.style.display = show ? 'flex' : 'none';
    });
}

// Export Grades Report
function exportGradesReport() {
    const report = window.DraftGradesSystem.exportGradesSummary();
    
    // Create and download file
    const blob = new Blob([report], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = '2026_NFL_Mock_Draft_Grades.txt';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    // Show toast
    showToast('Draft grades report exported!');
}

// Show Toast
function showToast(message) {
    const toast = document.createElement('div');
    toast.className = 'toast show';
    toast.textContent = message;
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), 3000);
}

// Initialize when tab is shown
document.addEventListener('DOMContentLoaded', function() {
    // Check if we're on the draft grades tab
    const draftGradesTab = document.getElementById('draftGrades');
    if (draftGradesTab && draftGradesTab.classList.contains('active')) {
        initDraftGradesTab();
    }
});
</script>
